<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <!-- æœ€é‡è¦çš„è§†å£è®¾ç½®ï¼Œç¡®ä¿æ‰‹æœºèƒ½æ­£ç¡®ç¼©æ”¾ -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ–°æ˜¥å¿ƒå½¢ç¥ç¦ç‰¹æ•ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background-color: #000;
            overflow: hidden;
            font-family: "Microsoft YaHei", "å¾®è½¯é›…é»‘", sans-serif;
            height: 100vh;
            width: 100vw;
            /* é˜²æ­¢æ‰‹æœºä¸Šçš„æ¨ªå‘æ»šåŠ¨ */
            overflow-x: hidden;
        }
        
        /* çƒŸèŠ±ç”»å¸ƒï¼ˆä¸­é—´å±‚ï¼‰ */
        #fireworksCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            pointer-events: none;
            display: none; /* åˆå§‹éšè— */
        }
        
        /* æç¤ºçª—å£æ ·å¼ - é€‚é…ç§»åŠ¨ç«¯ */
        .tip-window {
            position: absolute;
            width: 120px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            z-index: 10;
            opacity: 0;
            animation: fadeInStay 8s forwards;
            text-align: center;
            padding: 8px;
            font-weight: 500;
            color: #333;
            overflow: hidden;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            /* ç§»åŠ¨ç«¯é€‚é…ï¼šé˜²æ­¢æ–‡å­—æº¢å‡º */
            word-break: break-word;
            overflow-wrap: break-word;
        }
        
        /* æ–°å¹´å¿«ä¹å­—æ · - é€‚é…ç§»åŠ¨ç«¯ */
        .new-year-text {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 999;
            pointer-events: none;
            font-size: 15vw; /* ä½¿ç”¨vwå•ä½ï¼Œæ ¹æ®è§†å£å®½åº¦è°ƒæ•´ */
            opacity: 0;
            font-family: "Microsoft YaHei", "å¾®è½¯é›…é»‘", sans-serif;
            font-weight: bold;
            letter-spacing: 10px;
            background: linear-gradient(45deg, 
                #ff0000, #ff7700, #ffff00, #00ff00, 
                #00ffff, #0000ff, #7700ff, #ff00ff, #ff0000);
            background-size: 400% 400%;
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            color: transparent;
            text-shadow: 
                0 0 20px rgba(255, 255, 255, 0.5),
                0 0 40px rgba(255, 255, 255, 0.3);
            animation: 
                newYearFadeIn 8s ease-in-out forwards,
                gradientShift 5s ease-in-out infinite;
            /* ç§»åŠ¨ç«¯é€‚é…ï¼šç¡®ä¿æ–‡å­—ä¸ä¼šæº¢å‡º */
            text-align: center;
            padding: 0 10px;
        }
        
        /* å¼€å§‹äº¤äº’é®ç½©å±‚ */
        .start-mask {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: #000;
            z-index: 999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        /* æ–°æ˜¥æ–‡æ¡ˆæ ·å¼ - é€‚é…ç§»åŠ¨ç«¯ */
        .start-text {
            font-size: 28px;
            color: white;
            margin-bottom: 40px;
            text-align: center;
            letter-spacing: 3px;
            text-shadow: 0 0 20px rgba(255, 0, 51, 0.7);
            animation: textPulse 2s infinite alternate;
            /* ç§»åŠ¨ç«¯é€‚é…ï¼šé˜²æ­¢æ–‡å­—æº¢å‡º */
            padding: 0 15px;
            line-height: 1.4;
        }
        
        /* ç¡®å®šæŒ‰é’®æ ·å¼ - é€‚é…ç§»åŠ¨ç«¯è§¦æ‘¸ */
        .confirm-btn {
            background: linear-gradient(45deg, #ffd700, #ff9900);
            color: #d40000;
            border: none;
            padding: 18px 50px;
            font-size: 22px;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.5s;
            font-family: "Microsoft YaHei", "å¾®è½¯é›…é»‘", sans-serif;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.6);
            font-weight: bold;
            border: 2px solid rgba(255, 255, 255, 0.8);
            animation: btnPulse 2s infinite alternate;
            /* ç§»åŠ¨ç«¯é€‚é…ï¼šå¢åŠ è§¦æ‘¸åŒºåŸŸ */
            min-height: 60px;
            touch-action: manipulation; /* æ”¹å–„è§¦æ‘¸å“åº” */
        }
        
        .confirm-btn:hover {
            transform: scale(1.08);
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.8);
            background: linear-gradient(45deg, #fffacd, #ffc107);
        }
        
        /* è§¦æ‘¸è®¾å¤‡ä¸Šçš„æ‚¬åœæ•ˆæœæ›¿ä»£ */
        @media (hover: none) and (pointer: coarse) {
            .confirm-btn:active {
                transform: scale(1.08);
                box-shadow: 0 0 50px rgba(255, 215, 0, 0.8);
                background: linear-gradient(45deg, #fffacd, #ffc107);
            }
        }
        
        /* åŠ¨ç”» */
        @keyframes fadeInStay {
            0% {
                opacity: 0;
                transform: scale(0.5) rotate(-5deg);
            }
            15% {
                opacity: 1;
                transform: scale(1) rotate(0deg);
            }
            85% {
                opacity: 1;
                transform: scale(1) rotate(0deg);
            }
            100% {
                opacity: 1;
                transform: scale(1) rotate(0deg);
            }
        }
        
        @keyframes newYearFadeIn {
            0% {
                opacity: 0;
                transform: scale(0.5);
            }
            50% {
                opacity: 0.8;
                transform: scale(1.05);
            }
            100% {
                opacity: 0.8;
                transform: scale(1);
            }
        }
        
        @keyframes gradientShift {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }
        
        @keyframes textPulse {
            0% {
                opacity: 0.8;
                text-shadow: 0 0 20px rgba(255, 0, 51, 0.7);
            }
            100% {
                opacity: 1;
                text-shadow: 0 0 30px rgba(255, 0, 51, 0.9), 0 0 15px rgba(255, 100, 100, 0.6);
            }
        }
        
        @keyframes btnPulse {
            0% {
                opacity: 0.9;
                box-shadow: 0 0 30px rgba(255, 215, 0, 0.6);
            }
            100% {
                opacity: 1;
                box-shadow: 0 0 40px rgba(255, 215, 0, 0.8), 0 0 20px rgba(255, 230, 0, 0.5);
            }
        }
        
        /* ========== å“åº”å¼è®¾è®¡ - é€‚é…ä¸åŒè®¾å¤‡ ========== */
        
        /* å¹³æ¿è®¾å¤‡ (768px - 1024px) */
        @media (max-width: 1024px) {
            .tip-window {
                width: 110px;
                height: 55px;
                font-size: 15px;
            }
            
            .new-year-text {
                font-size: 18vw;
                letter-spacing: 8px;
            }
            
            .start-text {
                font-size: 26px;
                margin-bottom: 35px;
            }
            
            .confirm-btn {
                font-size: 20px;
                padding: 16px 45px;
                min-height: 55px;
            }
        }
        
        /* å¤§å±æ‰‹æœº (481px - 768px) */
        @media (max-width: 768px) {
            .tip-window {
                width: 100px;
                height: 50px;
                font-size: 14px;
                padding: 6px;
            }
            
            .new-year-text {
                font-size: 20vw;
                letter-spacing: 6px;
                padding: 0 20px;
            }
            
            .start-text {
                font-size: 22px;
                margin-bottom: 30px;
                letter-spacing: 2px;
                padding: 0 20px;
            }
            
            .confirm-btn {
                font-size: 18px;
                padding: 15px 40px;
                min-height: 50px;
                width: 80%;
                max-width: 300px;
            }
        }
        
        /* å°å±æ‰‹æœº (320px - 480px) */
        @media (max-width: 480px) {
            .tip-window {
                width: 90px;
                height: 45px;
                font-size: 13px;
                padding: 5px;
                border-radius: 6px;
            }
            
            .new-year-text {
                font-size: 25vw;
                letter-spacing: 4px;
                padding: 0 15px;
                line-height: 1.2;
                /* è¶…å°å±å¹•å¯èƒ½éœ€è¦æ¢è¡Œ */
                flex-wrap: wrap;
                word-break: keep-all;
            }
            
            /* è¶…å°å±å¹•ä¸‹ï¼Œ"æ–°å¹´å¿«ä¹"å››ä¸ªå­—åˆ†è¡Œæ˜¾ç¤º */
            @media (max-width: 350px) {
                .new-year-text {
                    font-size: 22vw;
                    letter-spacing: 2px;
                    flex-direction: column;
                    line-height: 1.1;
                }
            }
            
            .start-text {
                font-size: 18px;
                margin-bottom: 25px;
                letter-spacing: 1px;
                line-height: 1.5;
                padding: 0 15px;
            }
            
            .confirm-btn {
                font-size: 16px;
                padding: 12px 30px;
                min-height: 45px;
                width: 85%;
                max-width: 280px;
            }
        }
        
        /* è¶…å°å±æ‰‹æœº (å°äº320px) */
        @media (max-width: 320px) {
            .tip-window {
                width: 80px;
                height: 40px;
                font-size: 12px;
            }
            
            .new-year-text {
                font-size: 22vw;
                letter-spacing: 2px;
            }
            
            .start-text {
                font-size: 16px;
                margin-bottom: 20px;
            }
            
            .confirm-btn {
                font-size: 14px;
                padding: 10px 25px;
                min-height: 40px;
            }
        }
        
        /* æ¨ªå±æ¨¡å¼ */
        @media (max-height: 500px) and (orientation: landscape) {
            .start-text {
                font-size: 20px;
                margin-bottom: 20px;
            }
            
            .confirm-btn {
                padding: 10px 30px;
                min-height: 45px;
                font-size: 16px;
            }
            
            .tip-window {
                width: 90px;
                height: 40px;
                font-size: 12px;
            }
            
            .new-year-text {
                font-size: 15vh; /* æ¨ªå±æ—¶ä½¿ç”¨è§†å£é«˜åº¦ä½œä¸ºå•ä½ */
                letter-spacing: 5px;
            }
        }
    </style>
</head>
<body>
    <!-- å¼€å§‹äº¤äº’ç•Œé¢ï¼ˆæ–‡æ¡ˆ+ç¡®å®šæŒ‰é’®ï¼‰ -->
    <div class="start-mask" id="startMask">
        <div class="start-text">ğŸæ–°å¹´å¿«ä¹ï¼Œè¯·æŸ¥æ”¶å±äºæ‚¨çš„æ–°æ˜¥ç¥ç¦ğŸ</div>
        <button class="confirm-btn" onclick="startBlessing()">ç¡®å®š</button>
    </div>
    
    <!-- çƒŸèŠ±ç”»å¸ƒ -->
    <canvas id="fireworksCanvas"></canvas>
    
    <!-- åœ¨è¿™é‡Œæ·»åŠ èƒŒæ™¯éŸ³ä¹ -->
    <audio id="backgroundMusic" loop preload="auto">
        <source src="regret.mp3" type="audio/mpeg">
        æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘å…ƒç´ ã€‚
    </audio>
    
    <script>
        // ========== ç§»åŠ¨ç«¯é€‚é…ä¼˜åŒ– ==========
        
        // æ£€æµ‹æ˜¯å¦ä¸ºç§»åŠ¨è®¾å¤‡
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        
        // æ ¹æ®è®¾å¤‡ç±»å‹è°ƒæ•´é…ç½®
        const CONFIG = {
            points: isMobile ? 40 : 50, // ç§»åŠ¨ç«¯å‡å°‘ç‚¹æ•°ï¼Œé¿å…æ‹¥æŒ¤
            windowWidth: isMobile ? 100 : 120,
            windowHeight: isMobile ? 50 : 60,
            pointDelay: isMobile ? 100 : 90, // ç§»åŠ¨ç«¯ç¨æ…¢ä¸€ç‚¹
            tipDisplayTime: 8000
        };
        
        const TIPS = [
            "é¾™å¹´å¤§å‰ï¼Œä¸‡äº‹é¡ºæ„",
            "æ–°æ˜¥å¿«ä¹ï¼Œé˜–å®¶å¹¸ç¦",
            "èº«ä½“å¥åº·ï¼Œå¹³å®‰å–œä¹",
            "è´¢æºå¹¿è¿›ï¼Œå¯Œè´µå‰ç¥¥",
            "ç¬‘å£å¸¸å¼€ï¼Œå¥½è¿è¿è¿",
            "å¿ƒæƒ³äº‹æˆï¼Œç¾æ¢¦æˆçœŸ",
            "å¹´å¹´æœ‰ä½™ï¼Œå²å²æ— å¿§",
            "ç¦æ°”æ»¡æ»¡ï¼Œå–œæ°”æ´‹æ´‹",
            "é¾™é©¬ç²¾ç¥ï¼Œæ­¥æ­¥é«˜å‡",
            "å¹³å®‰å–œä¹ï¼Œå››å­£å®‰åº·",
            "æ–°æ˜¥å¤§å‰ï¼Œè¯¸äº‹é¡ºé‚",
            "å¥½è¿å¸¸åœ¨ï¼Œå–œäº‹ä¸´é—¨",
            "æ–°æ˜¥æ„‰å¿«ï¼Œå¹¸ç¦å¸¸ä¼´"
        ];
        
        let fireworks;
        let allTipWindows = [];
        
        // è°ƒæ•´çˆ±å¿ƒç”Ÿæˆå‡½æ•°ï¼Œé€‚é…ä¸åŒå±å¹•
        function generateHeartPoints(numPoints) {
            const points = [];
            const centerX = window.innerWidth / 2;
            const centerY = window.innerHeight / 2;
            
            // æ ¹æ®å±å¹•å°ºå¯¸åŠ¨æ€è°ƒæ•´çˆ±å¿ƒå¤§å°
            // ç§»åŠ¨ç«¯ä½¿ç”¨è¾ƒå°çš„ç¼©æ”¾æ¯”ä¾‹
            const scaleFactor = isMobile ? 0.8 : 1;
            const baseScale = Math.min(window.innerWidth, window.innerHeight) / (isMobile ? 50 : 40);
            const scale = baseScale * scaleFactor;
            
            for (let i = 0; i < numPoints; i++) {
                const t = i / numPoints * 2 * Math.PI;
                const x = 16 * Math.pow(Math.sin(t), 3);
                const y = 13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t);
                const adjustedY = -y;
                let pointX = centerX + x * scale;
                let pointY = centerY + adjustedY * scale;
                
                // ç¡®ä¿çˆ±å¿ƒä½ç½®åœ¨å±å¹•å†…
                pointX = Math.max(CONFIG.windowWidth / 2, Math.min(pointX, window.innerWidth - CONFIG.windowWidth / 2));
                pointY = Math.max(CONFIG.windowHeight / 2, Math.min(pointY, window.innerHeight - CONFIG.windowHeight / 2));
                
                points.push({x: Math.round(pointX), y: Math.round(pointY)});
            }
            
            return points;
        }
        
        function getRandomColor() {
            const r = Math.floor(Math.random() * 56) + 200;
            const g = Math.floor(Math.random() * 56) + 200;
            const b = Math.floor(Math.random() * 56) + 200;
            return `rgb(${r}, ${g}, ${b})`;
        }
        
        function showTipWindow(x, y) {
            const tipWindow = document.createElement('div');
            tipWindow.className = 'tip-window';
            
            // ç¡®ä¿ä½ç½®åœ¨å±å¹•å†…
            const left = Math.max(5, Math.min(x - CONFIG.windowWidth / 2, window.innerWidth - CONFIG.windowWidth - 5));
            const top = Math.max(5, Math.min(y - CONFIG.windowHeight / 2, window.innerHeight - CONFIG.windowHeight - 5));
            
            tipWindow.style.left = `${left}px`;
            tipWindow.style.top = `${top}px`;
            
            const bgColor = getRandomColor();
            tipWindow.style.backgroundColor = bgColor;
            const randomTip = TIPS[Math.floor(Math.random() * TIPS.length)];
            tipWindow.textContent = randomTip;
            document.body.appendChild(tipWindow);
            tipWindow.style.animationDuration = `${CONFIG.tipDisplayTime / 1000}s`;
            
            allTipWindows.push(tipWindow);
            return tipWindow;
        }
        
        function showNewYearText() {
            const newYearElement = document.createElement('div');
            newYearElement.className = 'new-year-text';
            newYearElement.textContent = 'æ–°å¹´å¿«ä¹';
            document.body.appendChild(newYearElement);
            
            // 25ç§’åæ·¡å‡ºå¹¶ç§»é™¤
            setTimeout(() => {
                newYearElement.style.opacity = '0';
                newYearElement.style.transition = 'opacity 3s ease-out';
                setTimeout(() => {
                    if (newYearElement.parentNode) {
                        newYearElement.parentNode.removeChild(newYearElement);
                    }
                }, 3000);
            }, 22000);
        }
        
        function startHeartAnimation() {
            const points = generateHeartPoints(CONFIG.points);
            
            // æ¸…ç©ºä¹‹å‰çš„çª—å£
            allTipWindows = [];
            
            // ä¾æ¬¡æ˜¾ç¤ºæ‰€æœ‰å¿ƒå½¢æç¤º
            points.forEach((point, index) => {
                setTimeout(() => {
                    showTipWindow(point.x, point.y);
                }, index * CONFIG.pointDelay);
            });
            
            // åœ¨çˆ±å¿ƒæ˜¾ç¤ºç»“æŸåç­‰å¾…3ç§’ï¼Œç„¶åæ˜¾ç¤ºæ–°å¹´å¿«ä¹å­—æ ·
            setTimeout(showNewYearText, (CONFIG.points * CONFIG.pointDelay) + 3000);
        }
        
        // ç‚¹å‡»ç¡®å®šæŒ‰é’®ï¼Œå¯åŠ¨ç‰¹æ•ˆ
        function startBlessing() {
            // éšè—å¼€å§‹é®ç½©å±‚
            const startMask = document.getElementById('startMask');
            startMask.style.display = 'none';
            
            // æ’­æ”¾èƒŒæ™¯éŸ³ä¹
            const bgMusic = document.getElementById('backgroundMusic');
            bgMusic.volume = isMobile ? 0.3 : 0.5; // ç§»åŠ¨ç«¯éŸ³é‡å°ä¸€äº›
            bgMusic.play().catch(e => {
                // å¤„ç†è‡ªåŠ¨æ’­æ”¾è¢«é˜»æ­¢çš„æƒ…å†µ
                console.log("è‡ªåŠ¨æ’­æ”¾è¢«é˜»æ­¢ï¼Œéœ€è¦ç”¨æˆ·äº¤äº’");
            });
            
            // æ˜¾ç¤ºçƒŸèŠ±ç”»å¸ƒ
            document.getElementById('fireworksCanvas').style.display = 'block';
            
            // åˆå§‹åŒ–çƒŸèŠ±å’Œå¯åŠ¨å¿ƒå½¢åŠ¨ç”»
            fireworks = new Fireworks();
            setTimeout(startHeartAnimation, 500);
        }
        
        // é¡µé¢åŠ è½½åæ˜¾ç¤ºå¼€å§‹ç•Œé¢
        document.addEventListener('DOMContentLoaded', () => {
            // å¦‚æœæ˜¯ç§»åŠ¨è®¾å¤‡ï¼Œè°ƒæ•´ä¸€äº›åˆå§‹è®¾ç½®
            if (isMobile) {
                console.log("ç§»åŠ¨è®¾å¤‡æ¨¡å¼å¯ç”¨");
            }
        });
        
        // çƒŸèŠ±æ•ˆæœç±»ï¼ˆä¿æŒä¸å˜ï¼‰
        class Fireworks {
            constructor() {
                this.canvas = document.getElementById('fireworksCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.particles = [];
                this.fireworks = [];
                this.resize();
                window.addEventListener('resize', () => this.resize());
                this.animate();
                this.createFireworks();
            }
            
            resize() {
                this.canvas.width = window.innerWidth;
                this.canvas.height = window.innerHeight;
            }
            
            createFireworks() {
                for (let i = 0; i < (isMobile ? 3 : 5); i++) {
                    setTimeout(() => this.createFirework(), i * 300);
                }
                setInterval(() => {
                    if (this.fireworks.length < (isMobile ? 6 : 8)) {
                        this.createFirework();
                    }
                }, 1500);
            }
            
            createFirework() {
                const x = Math.random() * this.canvas.width;
                const y = this.canvas.height;
                const targetY = Math.random() * this.canvas.height * 0.4;
                const speed = (isMobile ? 2.5 : 3) + Math.random() * 2.5;
                const color = `hsl(${Math.random() * 80 + 280}, 100%, 60%)`;
                
                this.fireworks.push({
                    x, y, targetY,
                    speed, color,
                    size: isMobile ? 2 : 2.5,
                    trail: []
                });
            }
            
            createParticles(x, y, color) {
                const particleCount = (isMobile ? 80 : 100) + Math.random() * 60;
                for (let i = 0; i < particleCount; i++) {
                    const angle = Math.random() * Math.PI * 2;
                    const speed = (isMobile ? 2 : 2.5) + Math.random() * 3.5;
                    const velocity = {
                        x: Math.cos(angle) * speed,
                        y: Math.sin(angle) * speed
                    };
                    
                    this.particles.push({
                        x, y,
                        velocity,
                        color,
                        size: (isMobile ? 1 : 1.5) + Math.random() * 2.5,
                        life: 120 + Math.random() * 60,
                        decay: 0.94 + Math.random() * 0.05
                    });
                }
            }
            
            animate() {
                requestAnimationFrame(() => this.animate());
                this.ctx.fillStyle = 'rgba(0, 0, 0, 0.09)';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                
                for (let i = this.fireworks.length - 1; i >= 0; i--) {
                    const firework = this.fireworks[i];
                    firework.trail.push({x: firework.x, y: firework.y});
                    if (firework.trail.length > 15) {
                        firework.trail.shift();
                    }
                    
                    for (let j = 0; j < firework.trail.length; j++) {
                        const point = firework.trail[j];
                        const alpha = j / firework.trail.length;
                        this.ctx.beginPath();
                        this.ctx.arc(point.x, point.y, firework.size * alpha * 1.2, 0, Math.PI * 2);
                        this.ctx.fillStyle = `rgba(${this.hexToRgb(firework.color)}, ${alpha * 0.7})`;
                        this.ctx.fill();
                    }
                    
                    firework.y -= firework.speed;
                    firework.x += Math.sin(Date.now() * 0.0015) * 0.7;
                    
                    this.ctx.beginPath();
                    this.ctx.arc(firework.x, firework.y, firework.size, 0, Math.PI * 2);
                    this.ctx.fillStyle = firework.color;
                    this.ctx.fill();
                    
                    this.ctx.beginPath();
                    this.ctx.arc(firework.x, firework.y, firework.size * 4, 0, Math.PI * 2);
                    const gradient = this.ctx.createRadialGradient(
                        firework.x, firework.y, 0,
                        firework.x, firework.y, firework.size * 4
                    );
                    gradient.addColorStop(0, firework.color.replace(')', ', 0.4)').replace('hsl', 'hsla'));
                    gradient.addColorStop(1, firework.color.replace(')', ', 0)').replace('hsl', 'hsla'));
                    this.ctx.fillStyle = gradient;
                    this.ctx.fill();
                    
                    if (firework.y <= firework.targetY) {
                        this.createParticles(firework.x, firework.y, firework.color);
                        this.fireworks.splice(i, 1);
                    }
                }
                
                for (let i = this.particles.length - 1; i >= 0; i--) {
                    const particle = this.particles[i];
                    particle.x += particle.velocity.x;
                    particle.y += particle.velocity.y;
                    particle.velocity.y += 0.04;
                    particle.life *= particle.decay;
                    
                    if (particle.life <= 1) {
                        this.particles.splice(i, 1);
                        continue;
                    }
                    
                    this.ctx.beginPath();
                    this.ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
                    this.ctx.fillStyle = `rgba(${this.hexToRgb(particle.color)}, ${particle.life / 100 * 0.8})`;
                    this.ctx.fill();
                    
                    this.ctx.beginPath();
                    this.ctx.moveTo(particle.x, particle.y);
                    this.ctx.lineTo(
                        particle.x - particle.velocity.x * 0.8,
                        particle.y - particle.velocity.y * 0.8
                    );
                    this.ctx.strokeStyle = `rgba(${this.hexToRgb(particle.color)}, ${particle.life / 200 * 0.6})`;
                    this.ctx.lineWidth = particle.size * 1.2;
                    this.ctx.stroke();
                }
            }
            
            hexToRgb(hex) {
                if (hex.startsWith('hsl')) {
                    const match = hex.match(/(\d+),\s*(\d+)%,\s*(\d+)%/);
                    if (match) {
                        const h = parseInt(match[1]);
                        const s = parseInt(match[2]);
                        const l = parseInt(match[3]);
                        return this.hslToRgb(h, s, l);
                    }
                }
                return '255, 255, 255';
            }
            
            hslToRgb(h, s, l) {
                s /= 100;
                l /= 100;
                const k = n => (n + h / 30) % 12;
                const a = s * Math.min(l, 1 - l);
                const f = n => l - a * Math.max(-1, Math.min(k(n) - 3, Math.min(9 - k(n), 1)));
                const r = Math.round(255 * f(0));
                const g = Math.round(255 * f(8));
                const b = Math.round(255 * f(4));
                return `${r}, ${g}, ${b}`;
            }
        }
    </script>
</body>
</html>
